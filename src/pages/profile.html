<!DOCTYPE html>
<script type="module">
  import {WideSideLayout} from '/src/components/layouts/Wide+Side.js';
  import {Form} from '/src/components/forms/Form.js';
  import {StandardButton as Button} from '/src/components/forms/StandardButton.js';
  import {RowInput as Input} from '/src/components/forms/RowInput.js';
  import {RowLink as Link} from '/src/components/forms/RowLink.js';
  import {AvatarControl, AvatarPopup} from '/src/components/forms/Avatar.js';
  import {JSONWrapper} from '/src/modules/Utils.js';

  const view = new WideSideLayout({
    title: 'Профиль',
    backButtonLink: 'chats.html',
    Form, Button, Input, Link, AvatarControl, AvatarPopup
  });

  view.props.popup = AvatarPopup;
  view.props.contents = `%{ Form({ "name": "profile", "action": "" }) }%`;

  const userData = {
    email: 'pochta@yandex.ru',
    login: 'ivanovivan',
    first_name: 'Иван',
    second_name: 'Иванов',
    display_name: 'Ivan Ivanov',
    phone: '+77777777777'
  };

  let inputs = [
    { name: 'email', type: 'email', label: 'Почта' },
    { name: 'login', type: 'text', label: 'Логин' },
    { name: 'first_name', type: 'text', label: 'Имя' },
    { name: 'second_name', type: 'text', label: 'Фамилия' },
    { name: 'display_name', type: 'text', label: 'Имя в чате' },
    { name: 'phone', type: 'tel', label: 'Телефон' }
  ];

  for (const input of inputs) {
    input.value = userData[input.name];
    input.readonly = true;
  }

  inputs = JSONWrapper.stringify(inputs);

  view.props.fieldset = () => `
    %{ AvatarControl }%
    <h1 class="container__header">${userData.first_name}</h1>
    %{ Input(${inputs}...) }%
    <br><br><br>
    %{ Link({ "url": "profile_edit.html", "label": "Изменить данные" }) }%
    %{ Link({ "url": "profile_newpass.html", "label": "Изменить пароль" }) }%
    %{ Link({ "url": "auth.html", "label": "Выйти", "style": "container__link_red" }) }%
    <br><br>
  `;

  view.renderToBody();

</script>
